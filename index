<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7f1 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.2rem;
            font-weight: 600;
            letter-spacing: -0.5px;
        }
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 30px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        }
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 25px;
            border-bottom: 2px solid #eaeff5;
            padding-bottom: 10px;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px 15px;
            cursor: pointer;
            font-weight: 500;
            color: #7f8c9d;
            border-radius: 12px 12px 0 0;
            transition: all 0.3s ease;
            background: #f8fafc;
        }
        .tab:hover {
            color: #3498db;
            background: #f0f7ff;
        }
        .tab.active {
            background: white;
            color: #3498db;
            font-weight: 600;
            box-shadow: 0 -2px 10px rgba(52, 152, 219, 0.15);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .doc-type-group {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            background: #f8fafc;
            padding: 20px;
            border-radius: 14px;
            border: 1px solid #eaeff5;
        }
        .doc-type-option {
            flex: 1;
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
            border: 2px solid #e1e8f0;
        }
        .doc-type-option:hover {
            border-color: #3498db;
            background: #f0f7ff;
        }
        .doc-type-option.active {
            border-color: #3498db;
            background: #e3f2fd;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
        }
        .doc-type-option label {
            display: block;
            cursor: pointer;
        }
        .doc-type-option input[type="radio"] {
            display: none;
        }
        .form-group {
            margin-bottom: 22px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: #2c3e50;
            font-size: 1.05rem;
        }
        input, select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e1e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background: #f8fafc;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            background: white;
        }
        .days-section {
            background: #f8fafc;
            border-radius: 14px;
            padding: 25px;
            margin: 25px 0;
            border: 1px solid #eaeff5;
        }
        .days-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4rem;
            font-weight: 600;
        }
        .days-counter {
            color: #3498db;
            font-weight: 500;
            font-size: 1.1rem;
            margin: 10px 0 20px;
            padding: 8px 15px;
            background: #e3f2fd;
            border-radius: 10px;
            display: inline-block;
        }
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 180px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        .btn:active {
            transform: translateY(0);
        }
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #2980b9, #2573a7);
        }
        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        .btn-warning:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
        }
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        .btn-danger:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }
        .btn-export {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }
        .btn-export:hover {
            background: linear-gradient(135deg, #27ae60, #219653);
        }
        .btn-add-day {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
        }
        .btn-add-day:hover {
            background: linear-gradient(135deg, #8e44ad, #7d3c98);
        }
        .btn-clear-objects {
            background: linear-gradient(135deg, #7f8c8d, #34495e);
            color: white;
        }
        .btn-clear-objects:hover {
            background: linear-gradient(135deg, #34495e, #2c3e50);
        }
        .btn-edit {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        .btn-edit:hover {
            background: linear-gradient(135deg, #2980b9, #2573a7);
        }
        .controls {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin: 25px 0;
            justify-content: center;
        }
        .day-item {
            background: white;
            border-radius: 14px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #eaeff5;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
            transition: all 0.3s ease;
        }
        .day-item:hover {
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            border-color: #3498db;
        }
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaeff5;
        }
        .day-number {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
        }
        .hours-display {
            background: #e3f2fd;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin: 25px 0;
            font-size: 1.4rem;
            font-weight: 600;
            color: #2c3e50;
            box-shadow: inset 0 2px 8px rgba(52, 152, 219, 0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        }
        th, td {
            padding: 16px 20px;
            text-align: left;
            border-bottom: 1px solid #eaeff5;
        }
        th {
            background: #f8fafc;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.05rem;
        }
        tr:last-child td {
            border-bottom: none;
        }
        tr:hover {
            background: #f8fafc;
        }
        .month-group {
            margin: 25px 0;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        }
        .month-header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            font-size: 1.4rem;
            font-weight: 600;
            text-align: center;
        }
        .month-total {
            background: #e3f2fd;
            padding: 20px;
            text-align: right;
            font-weight: 600;
            font-size: 1.3rem;
            color: #2980b9;
            border-top: 2px solid #3498db;
        }
        .objects-section {
            margin: 25px 0;
        }
        .objects-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            padding: 10px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #eaeff5;
        }
        .object-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid #eaeff5;
            transition: all 0.2s ease;
        }
        .object-item:hover {
            border-color: #3498db;
            transform: translateX(5px);
        }
        .clear-buttons {
            display: flex;
            gap: 16px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .date-warning {
            color: #e67e22;
            background: #fff8e1;
            padding: 12px;
            border-radius: 12px;
            margin: 15px 0;
            font-size: 0.95rem;
            border-left: 3px solid #f39c12;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞ */
        .chart-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin: 25px 0;
        }
        .chart-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .chart-header h2 {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .chart-header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        .chart-filters {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .chart-filter-group {
            text-align: center;
            min-width: 180px;
        }
        .chart-filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }
        .chart-tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
            background: #f8fafc;
            padding: 15px;
            border-radius: 14px;
            border: 1px solid #eaeff5;
        }
        .chart-tab {
            padding: 12px 25px;
            border-radius: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            border: 2px solid #e1e8f0;
        }
        .chart-tab:hover {
            border-color: #3498db;
            background: #f0f7ff;
        }
        .chart-tab.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-color: #3498db;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
        }
        .chart-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-card.orange {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa502 100%);
        }
        .stat-card.green {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
        }
        .stat-card.purple {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        }
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
        }
        .stat-label {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        canvas {
            max-width: 100%;
            height: 400px !important;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eaeff5;
        }
        .modal-title {
            font-size: 1.8rem;
            color: #2c3e50;
            font-weight: 600;
        }
        .close-modal {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        @media (max-width: 768px) {
            .card {
                padding: 20px;
            }
            .tabs {
                flex-direction: column;
            }
            .doc-type-group {
                flex-direction: column;
            }
            .controls {
                flex-direction: column;
            }
            .btn {
                width: 100%;
                min-width: auto;
            }
            .clear-buttons {
                flex-direction: column;
            }
            .chart-filters {
                flex-direction: column;
                align-items: center;
            }
            .chart-tabs {
                flex-direction: column;
            }
            .chart-tab {
                width: 100%;
            }
            canvas {
                height: 300px !important;
            }
            .modal-content {
                padding: 20px;
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ</h1>
        <div class="card">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('main')">üìù –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</div>
                <div class="tab" onclick="switchTab('objects')">üè¢ –û–±—ä–µ–∫—Ç—ã</div>
                <div class="tab" onclick="switchTab('records')">üìã –í—Å–µ –∑–∞–ø–∏—Å–∏</div>
                <div class="tab" onclick="switchTab('chart')">üìà –ì—Ä–∞—Ñ–∏–∫</div>
            </div>
            <div class="tab-content active" id="main-tab">
                <div class="doc-type-group">
                    <div class="doc-type-option active" onclick="selectDocType('–Ω–∞—Ä—è–¥')">
                        <label>
                            <input type="radio" name="docType" value="–Ω–∞—Ä—è–¥" checked> –ù–∞—Ä—è–¥
                        </label>
                        <small>–¥–æ 30 –¥–Ω–µ–π, —Ä–∞–∑–Ω–∏—Ü–∞ –Ω–µ –±–æ–ª–µ–µ 30 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π</small>
                    </div>
                    <div class="doc-type-option" onclick="selectDocType('—Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ')">
                        <label>
                            <input type="radio" name="docType" value="—Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ"> –†–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ
                        </label>
                        <small>—Ç–æ–ª—å–∫–æ 1 –¥–µ–Ω—å</small>
                    </div>
                </div>
                <div class="form-group">
                    <label for="docNumber">–ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞:</label>
                    <input type="text" id="docNumber" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä">
                </div>
                <div class="form-group">
                    <label for="objectSelect">–ú–µ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–æ–±—ä–µ–∫—Ç):</label>
                    <select id="objectSelect">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç</option>
                    </select>
                </div>
                <div class="days-section">
                    <h3>üìÖ –î–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç</h3>
                    <div class="days-counter">
                        –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: <span id="daysCount">0</span>/30
                    </div>
                    <div id="dateWarning" class="date-warning" style="display: none;"></div>
                    <button class="btn btn-add-day" onclick="addDay()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–µ–Ω—å</button>
                    <div id="daysContainer"></div>
                </div>
                <div class="hours-display">
                    üí∞ –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤: <span id="totalHours">0.00</span>
                </div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="saveOrder()">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                    <button class="btn btn-warning" onclick="clearForm()">üîÑ –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
                </div>
            </div>
            <div class="tab-content" id="objects-tab">
                <div class="objects-section">
                    <h3>üè¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞–º–∏</h3>
                    <div class="form-group">
                        <label for="newObject">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞:</label>
                        <input type="text" id="newObject" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞">
                    </div>
                    <button class="btn btn-primary" onclick="addObject()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç</button>
                    <div class="clear-buttons">
                        <button class="btn btn-clear-objects" onclick="clearAllObjects()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã</button>
                    </div>
                    <h4>üìã –°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤:</h4>
                    <div class="objects-list" id="objectsList"></div>
                </div>
            </div>
            <div class="tab-content" id="records-tab">
                <div class="controls">
                    <button class="btn btn-export" onclick="exportToExcel()">üì• –í—ã–≥—Ä—É–∑–∏—Ç—å –≤ Excel</button>
                    <button class="btn btn-danger" onclick="clearAllRecords()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏</button>
                </div>
                <h2>üìã –í—Å–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–ø–∏—Å–∏</h2>
                <div id="groupedRecords"></div>
            </div>
            <div class="tab-content" id="chart-tab">
                <div class="chart-container">
                    <div class="chart-header">
                        <h2>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤</h2>
                        <p>–ê–Ω–∞–ª–∏–∑ –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —á–∞—Å–æ–≤ –ø–æ —Ä–∞–∑–Ω—ã–º –ø–µ—Ä–∏–æ–¥–∞–º</p>
                    </div>
                    <div class="chart-filters">
                        <div class="chart-filter-group">
                            <label for="chartPeriod">üìÖ –ü–µ—Ä–∏–æ–¥</label>
                            <select id="chartPeriod" class="btn" onchange="updateChart()">
                                <option value="week">–ù–µ–¥–µ–ª—è</option>
                                <option value="month" selected>–ú–µ—Å—è—Ü</option>
                                <option value="quarter">–ö–≤–∞—Ä—Ç–∞–ª</option>
                                <option value="year">–ì–æ–¥</option>
                            </select>
                        </div>
                        <div class="chart-filter-group">
                            <label for="chartType">üìä –¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞</label>
                            <select id="chartType" class="btn" onchange="updateChart()">
                                <option value="bar">–°—Ç–æ–ª–±—á–∞—Ç—ã–π</option>
                                <option value="line" selected>–õ–∏–Ω–µ–π–Ω—ã–π</option>
                                <option value="area">–û–±–ª–∞—Å—Ç–Ω–æ–π</option>
                            </select>
                        </div>
                        <div class="chart-filter-group">
                            <label for="chartObject">üè¢ –û–±—ä–µ–∫—Ç</label>
                            <select id="chartObject" class="btn" onchange="updateChart()">
                                <option value="all">–í—Å–µ –æ–±—ä–µ–∫—Ç—ã</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-tabs">
                        <div class="chart-tab active" onclick="switchChartTab('daily')">üìÜ –ü–æ –¥–Ω—è–º</div>
                        <div class="chart-tab" onclick="switchChartTab('monthly')">üìÜ –ü–æ –º–µ—Å—è—Ü–∞–º</div>
                        <div class="chart-tab" onclick="switchChartTab('byType')">üìÑ –ü–æ —Ç–∏–ø—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</div>
                    </div>
                    <div style="height: 400px; margin: 20px 0;">
                        <canvas id="hoursChart"></canvas>
                    </div>
                    <div class="chart-actions">
                        <button class="btn btn-export" onclick="downloadChart()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫</button>
                        <button class="btn btn-warning" onclick="resetChartFilters()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                    </div>
                    <div class="summary-stats">
                        <div class="stat-card">
                            <div class="stat-label">–í—Å–µ–≥–æ —á–∞—Å–æ–≤</div>
                            <div class="stat-value" id="totalHoursStat">0.00</div>
                        </div>
                        <div class="stat-card orange">
                            <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ –≤ –¥–µ–Ω—å</div>
                            <div class="stat-value" id="avgHoursStat">0.00</div>
                        </div>
                        <div class="stat-card green">
                            <div class="stat-label">–ú–∞–∫—Å–∏–º—É–º —á–∞—Å–æ–≤</div>
                            <div class="stat-value" id="maxHoursStat">0.00</div>
                        </div>
                        <div class="stat-card purple">
                            <div class="stat-label">–î–Ω–µ–π —Å —Ä–∞–±–æ—Ç–æ–π</div>
                            <div class="stat-value" id="daysCountStat">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏</div>
                <button class="close-modal" onclick="closeEditModal()">&times;</button>
            </div>
            <div id="editFormContainer">
                <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å—é–¥–∞ -->
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="saveEditedOrder()">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                <button class="btn btn-warning" onclick="closeEditModal()">‚ùå –û—Ç–º–µ–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentDays = [];
        let maxDays = 30; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–∞—Ä—è–¥–∞
        let hoursChart = null;
        let currentChartTab = 'daily';
        let editingOrderId = null; // ID –∑–∞–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä—É—é —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.addEventListener('DOMContentLoaded', function() {
            loadObjects();
            loadGroupedOrders();
            addDay(); // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            loadChartObjects();
            initChart();
        });
        
        function selectDocType(type) {
            document.querySelectorAll('input[name="docType"]').forEach(radio => {
                radio.checked = (radio.value === type);
            });
            
            document.querySelectorAll('.doc-type-option').forEach(option => {
                option.classList.remove('active');
            });
            
            if (type === '–Ω–∞—Ä—è–¥') {
                document.querySelector('.doc-type-option:first-child').classList.add('active');
                maxDays = 30;
            } else {
                document.querySelector('.doc-type-option:last-child').classList.add('active');
                maxDays = 1;
                
                // –ï—Å–ª–∏ —Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ –∏ –±–æ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ –¥–Ω—è, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π
                if (currentDays.length > 1) {
                    currentDays = [currentDays[0]];
                    renderAllDays();
                }
            }
            
            updateDaysCount();
            checkDateConstraints();
        }
        
        function switchTab(tabName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Ç–∞–±—ã
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –°–Ω—è—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É
            const tabButtons = document.querySelectorAll('.tab');
            if (tabName === 'main') tabButtons[0].classList.add('active');
            if (tabName === 'objects') tabButtons[1].classList.add('active');
            if (tabName === 'records') tabButtons[2].classList.add('active');
            if (tabName === 'chart') tabButtons[3].classList.add('active');
            
            // –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –∑–∞–ø–∏—Å–∏, –æ–±–Ω–æ–≤–ª—è–µ–º –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É
            if (tabName === 'records') {
                loadGroupedOrders();
            }
            
            // –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫, –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            if (tabName === 'chart') {
                updateChart();
            }
        }
        
        function formatDateString(dateString) {
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}.${month}.${year}`;
        }
        
        function getMonthName(dateString) {
            const date = new Date(dateString);
            const months = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', 
                          '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
            return `${months[date.getMonth()]} ${date.getFullYear()}`;
        }
        
        function calculateDayHours(dayIndex) {
            const day = currentDays[dayIndex];
            if (!day) return 0;
            
            if (day.startTime && day.endTime) {
                const start = new Date(`2000-01-01T${day.startTime}`);
                const end = new Date(`2000-01-01T${day.endTime}`);
                
                if (end <= start) {
                    end.setDate(end.getDate() + 1);
                }
                
                const diffMs = end - start;
                const diffHours = diffMs / (1000 * 60 * 60);
                day.hours = diffHours.toFixed(2);
                return diffHours;
            }
            return 0;
        }
        
        function updateTotalHours() {
            const totalHours = currentDays.reduce((sum, day) => sum + (parseFloat(day.hours) || 0), 0);
            document.getElementById('totalHours').textContent = totalHours.toFixed(2);
        }
        
        function addDay() {
            if (currentDays.length >= maxDays) {
                alert(maxDays === 1 ? 
                    '–†–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ –≤—ã–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ 1 –¥–µ–Ω—å!' : 
                    '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π (30) –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ!');
                return;
            }
            
            const dayIndex = currentDays.length;
            const today = new Date().toISOString().split('T')[0];
            
            const day = {
                id: Date.now() + dayIndex,
                date: today,
                startTime: '',
                endTime: '',
                hours: '0.00'
            };
            
            currentDays.push(day);
            renderDay(dayIndex);
            updateDaysCount();
            updateTotalHours();
            checkDateConstraints();
        }
        
        function renderDay(dayIndex) {
            const day = currentDays[dayIndex];
            const daysContainer = document.getElementById('daysContainer');
            
            const dayElement = document.createElement('div');
            dayElement.className = 'day-item';
            dayElement.id = `day-${day.id}`;
            dayElement.innerHTML = `
                <div class="day-header">
                    <span class="day-number">üìÖ –î–µ–Ω—å ${dayIndex + 1}</span>
                    ${currentDays.length > 1 || maxDays > 1 ? `<button class="btn btn-danger" style="padding: 8px 15px; min-width: auto; font-size: 0.9rem;" onclick="removeDay(${dayIndex})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>` : ''}
                </div>
                <div class="form-group">
                    <label>–î–∞—Ç–∞:</label>
                    <input type="date" value="${day.date}" onchange="updateDayDate(${dayIndex}, this.value)">
                </div>
                <div class="form-group">
                    <label>–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞:</label>
                    <input type="time" onchange="updateDayTime(${dayIndex}, 'start', this.value)">
                </div>
                <div class="form-group">
                    <label>–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
                    <input type="time" onchange="updateDayTime(${dayIndex}, 'end', this.value)">
                </div>
                <div class="hours-display">
                    ‚è∞ –ß–∞—Å–æ–≤ –∑–∞ –¥–µ–Ω—å: <span id="day-hours-${dayIndex}">0.00</span>
                </div>
            `;
            
            daysContainer.appendChild(dayElement);
        }
        
        function renderAllDays() {
            const daysContainer = document.getElementById('daysContainer');
            daysContainer.innerHTML = '';
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–Ω–∏ –ø–æ –¥–∞—Ç–µ –ø–µ—Ä–µ–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
            currentDays.sort((a, b) => new Date(a.date) - new Date(b.date));
            currentDays.forEach((_, index) => {
                renderDay(index);
            });
        }
        
        function updateDayDate(dayIndex, dateValue) {
            if (currentDays[dayIndex]) {
                currentDays[dayIndex].date = dateValue;
                checkDateConstraints();
            }
        }
        
        function updateDayTime(dayIndex, type, timeValue) {
            if (currentDays[dayIndex]) {
                if (type === 'start') {
                    currentDays[dayIndex].startTime = timeValue;
                } else {
                    currentDays[dayIndex].endTime = timeValue;
                }
                
                const hours = calculateDayHours(dayIndex);
                document.getElementById(`day-hours-${dayIndex}`).textContent = hours.toFixed(2);
                updateTotalHours();
            }
        }
        
        function removeDay(dayIndex) {
            if (currentDays.length <= 1 && maxDays === 1) {
                alert('–î–ª—è —Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–∏–Ω –¥–µ–Ω—å!');
                return;
            }
            
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å?')) {
                const dayId = currentDays[dayIndex].id;
                currentDays.splice(dayIndex, 1);
                
                // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏–∑ DOM
                const dayElement = document.getElementById(`day-${dayId}`);
                if (dayElement) {
                    dayElement.remove();
                }
                
                // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–Ω–∏ —Å –Ω–æ–≤—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏
                renderAllDays();
                
                updateDaysCount();
                updateTotalHours();
                checkDateConstraints();
            }
        }
        
        function updateDaysCount() {
            document.getElementById('daysCount').textContent = currentDays.length;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
            const isOrder = document.querySelector('input[name="docType"]:checked').value === '–Ω–∞—Ä—è–¥';
            const daysLimitText = document.querySelector('.days-counter');
            
            if (isOrder) {
                daysLimitText.innerHTML = `–¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: <span id="daysCount">${currentDays.length}</span>/30`;
            } else {
                daysLimitText.innerHTML = `–¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: <span id="daysCount">${currentDays.length}</span>/1`;
            }
        }
        
        function checkDateConstraints() {
            const isOrder = document.querySelector('input[name="docType"]:checked').value === '–Ω–∞—Ä—è–¥';
            const dateWarning = document.getElementById('dateWarning');
            dateWarning.style.display = 'none';
            
            if (!isOrder) return; // –î–ª—è —Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞
            
            if (currentDays.length < 2) return; // –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 –¥–Ω—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–Ω–∏ –ø–æ –¥–∞—Ç–µ
            const sortedDays = [...currentDays].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–∞—Ç
            let isSequential = true;
            for (let i = 1; i < sortedDays.length; i++) {
                const prevDate = new Date(sortedDays[i-1].date);
                const currDate = new Date(sortedDays[i].date);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –Ω–µ —Ä–∞–Ω—å—à–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π
                if (currDate < prevDate) {
                    isSequential = false;
                    break;
                }
            }
            
            if (!isSequential) {
                dateWarning.textContent = '‚ö†Ô∏è –î–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ! –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏.';
                dateWarning.style.display = 'block';
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–Ω–∏—Ü—ã –≤ 30 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π
            const firstDate = new Date(sortedDays[0].date);
            const lastDate = new Date(sortedDays[sortedDays.length - 1].date);
            const diffTime = Math.abs(lastDate - firstDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays > 30) {
                dateWarning.textContent = `‚ö†Ô∏è –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ø–µ—Ä–≤–æ–π (${formatDateString(sortedDays[0].date)}) –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π (${formatDateString(sortedDays[sortedDays.length - 1].date)}) –¥–∞—Ç–∞–º–∏ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ${diffDays} –¥–Ω–µ–π. –ú–∞–∫—Å–∏–º—É–º 30 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π –¥–ª—è –æ–¥–Ω–æ–≥–æ –Ω–∞—Ä—è–¥–∞!`;
                dateWarning.style.display = 'block';
                return false;
            }
            
            return true;
        }
        
        function loadObjects() {
            const objects = JSON.parse(localStorage.getItem('workObjects')) || [];
            const objectSelect = document.getElementById('objectSelect');
            const objectsList = document.getElementById('objectsList');
            
            // –û—á–∏—â–∞–µ–º —Å–µ–ª–µ–∫—Ç (–∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–≥–æ option)
            while (objectSelect.options.length > 1) {
                objectSelect.remove(1);
            }
            
            // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤
            objectsList.innerHTML = '';
            
            objects.forEach((object, index) => {
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–µ–ª–µ–∫—Ç
                const option = document.createElement('option');
                option.value = object;
                option.textContent = object;
                objectSelect.appendChild(option);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                const objectItem = document.createElement('div');
                objectItem.className = 'object-item';
                objectItem.innerHTML = `
                    <span>${object}</span>
                    <button class="btn btn-danger" style="padding: 6px 12px; min-width: auto; font-size: 0.85rem;" onclick="deleteObject(${index})">üóëÔ∏è</button>
                `;
                objectsList.appendChild(objectItem);
            });
        }
        
        function loadChartObjects() {
            const objects = JSON.parse(localStorage.getItem('workObjects')) || [];
            const chartObjectSelect = document.getElementById('chartObject');
            
            // –û—á–∏—â–∞–µ–º —Å–µ–ª–µ–∫—Ç (–∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–≥–æ option)
            while (chartObjectSelect.options.length > 1) {
                chartObjectSelect.remove(1);
            }
            
            objects.forEach(object => {
                const option = document.createElement('option');
                option.value = object;
                option.textContent = object;
                chartObjectSelect.appendChild(option);
            });
        }
        
        function addObject() {
            const newObjectInput = document.getElementById('newObject');
            const newObject = newObjectInput.value.trim();
            
            if (!newObject) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞!');
                return;
            }
            
            let objects = JSON.parse(localStorage.getItem('workObjects')) || [];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
            if (objects.includes(newObject)) {
                alert('–¢–∞–∫–æ–π –æ–±—ä–µ–∫—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
                return;
            }
            
            objects.push(newObject);
            localStorage.setItem('workObjects', JSON.stringify(objects));
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            newObjectInput.value = '';
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤
            loadObjects();
            loadChartObjects();
            
            alert('‚úÖ –û–±—ä–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
        }
        
        function deleteObject(index) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç?')) {
                let objects = JSON.parse(localStorage.getItem('workObjects')) || [];
                objects.splice(index, 1);
                localStorage.setItem('workObjects', JSON.stringify(objects));
                loadObjects();
                loadChartObjects();
            }
        }
        
        function clearAllObjects() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –í–°–ï –æ–±—ä–µ–∫—Ç—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                localStorage.removeItem('workObjects');
                loadObjects();
                loadChartObjects();
                alert('‚úÖ –í—Å–µ –æ–±—ä–µ–∫—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω—ã!');
            }
        }
        
        function saveOrder() {
            const docType = document.querySelector('input[name="docType"]:checked').value;
            const docNumber = document.getElementById('docNumber').value.trim();
            const object = document.getElementById('objectSelect').value;
            
            if (!docNumber || !object) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç!');
                return;
            }
            
            if (currentDays.length === 0) {
                alert('‚ö†Ô∏è –î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –¥–µ–Ω—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç!');
                return;
            }
            
            // –î–ª—è —Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –¥–µ–Ω—å
            if (docType === '—Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ' && currentDays.length > 1) {
                alert('‚ö†Ô∏è –†–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ –≤—ã–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–∏–Ω –¥–µ–Ω—å!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è
            for (let i = 0; i < currentDays.length; i++) {
                const day = currentDays[i];
                if (!day.startTime || !day.endTime) {
                    alert(`‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–ª—è –¥–Ω—è ${i + 1}!`);
                    return;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –Ω–∞—Ä—è–¥–æ–≤
            if (docType === '–Ω–∞—Ä—è–¥') {
                if (currentDays.length > 30) {
                    alert('‚ö†Ô∏è –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è –Ω–∞—Ä—è–¥–∞ - 30!');
                    return;
                }
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–Ω–∏ –ø–æ –¥–∞—Ç–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                currentDays.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–Ω–∏—Ü—ã –≤ 30 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π
                const firstDate = new Date(currentDays[0].date);
                const lastDate = new Date(currentDays[currentDays.length - 1].date);
                const diffTime = Math.abs(lastDate - firstDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays > 30) {
                    alert(`‚ùå –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ø–µ—Ä–≤–æ–π –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –¥–∞—Ç–∞–º–∏ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ${diffDays} –¥–Ω–µ–π. –ú–∞–∫—Å–∏–º—É–º 30 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π –¥–ª—è –æ–¥–Ω–æ–≥–æ –Ω–∞—Ä—è–¥–∞!`);
                    return;
                }
            }
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤
            const totalHours = currentDays.reduce((sum, day) => sum + parseFloat(day.hours), 0);
            
            const order = {
                id: Date.now(),
                docType: docType,
                docNumber: docNumber,
                object: object,
                days: [...currentDays], // –ö–æ–ø–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –¥–Ω–µ–π
                totalHours: totalHours.toFixed(2),
                timestamp: new Date().toISOString()
            };
            
            // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏
            let orders = JSON.parse(localStorage.getItem('workOrders')) || [];
            orders.push(order);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem('workOrders', JSON.stringify(orders));
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            clearForm();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –∑–∞–ø–∏—Å–µ–π
            loadGroupedOrders();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –æ–Ω –∞–∫—Ç–∏–≤–µ–Ω
            if (document.getElementById('chart-tab').classList.contains('active')) {
                updateChart();
            }
            
            alert('‚úÖ –ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
        }
        
        function clearForm() {
            document.getElementById('docNumber').value = '';
            document.getElementById('objectSelect').selectedIndex = 0;
            document.querySelector('input[name="docType"][value="–Ω–∞—Ä—è–¥"]').checked = true;
            document.querySelector('.doc-type-option:first-child').classList.add('active');
            document.querySelector('.doc-type-option:last-child').classList.remove('active');
            
            // –û—á–∏—â–∞–µ–º –¥–Ω–∏
            currentDays = [];
            document.getElementById('daysContainer').innerHTML = '';
            addDay(); // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å
            
            document.getElementById('totalHours').textContent = '0.00';
            document.getElementById('dateWarning').style.display = 'none';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            editingOrderId = null;
        }
        
        function loadGroupedOrders() {
            const orders = JSON.parse(localStorage.getItem('workOrders')) || [];
            const groupedContainer = document.getElementById('groupedRecords');
            groupedContainer.innerHTML = '';
            
            if (orders.length === 0) {
                groupedContainer.innerHTML = '<p style="text-align: center; padding: 30px; color: #7f8c8d; font-size: 1.1rem;">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</p>';
                return;
            }
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –º–µ—Å—è—Ü–∞–º
            const groupedByMonth = {};
            const monthOrder = [];
            
            orders.forEach(order => {
                // –ë–µ—Ä–µ–º –¥–∞—Ç—É –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
                const firstDayDate = order.days[0].date;
                const monthKey = getMonthName(firstDayDate);
                
                if (!groupedByMonth[monthKey]) {
                    groupedByMonth[monthKey] = [];
                    monthOrder.push(monthKey);
                }
                
                groupedByMonth[monthKey].push(order);
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –º–µ—Å—è—Ü—ã –ø–æ –¥–∞—Ç–µ (–æ–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫)
            monthOrder.sort((a, b) => {
                const dateA = new Date(a.split(' ')[1], getMonthIndex(a.split(' ')[0]), 1);
                const dateB = new Date(b.split(' ')[1], getMonthIndex(b.split(' ')[0]), 1);
                return dateB - dateA;
            });
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º HTML –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã
            monthOrder.forEach(month => {
                const monthOrders = groupedByMonth[month];
                let monthTotalHours = 0;
                
                const monthDiv = document.createElement('div');
                monthDiv.className = 'month-group';
                
                monthDiv.innerHTML = `
                    <div class="month-header">${month}</div>
                    <table>
                        <thead>
                            <tr>
                                <th>–¢–∏–ø</th>
                                <th>–ù–æ–º–µ—Ä</th>
                                <th>–û–±—ä–µ–∫—Ç</th>
                                <th>–î–Ω–µ–π</th>
                                <th>–ß–∞—Å–æ–≤</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="month-table-${month.replace(/\s+/g, '-')}">
                        </tbody>
                    </table>
                    <div class="month-total">
                        üí∞ –ò—Ç–æ–≥–æ –∑–∞ –º–µ—Å—è—Ü: <span id="month-total-${month.replace(/\s+/g, '-')}">0.00</span> —á–∞—Å–æ–≤
                    </div>
                `;
                
                groupedContainer.appendChild(monthDiv);
                
                const tableBody = document.getElementById(`month-table-${month.replace(/\s+/g, '-')}`);
                
                monthOrders.forEach(order => {
                    monthTotalHours += parseFloat(order.totalHours);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${order.docType === '–Ω–∞—Ä—è–¥' ? 'üìù –ù–∞—Ä—è–¥' : 'üìã –†–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ'}</td>
                        <td>${order.docNumber}</td>
                        <td>${order.object}</td>
                        <td>${order.days.length}</td>
                        <td>${order.totalHours}</td>
                        <td>
                            <button class="btn btn-warning" style="padding: 6px 12px; min-width: auto; font-size: 0.85rem;" onclick="viewOrderDetails(${order.id})">‚ìò</button>
                            <button class="btn btn-edit" style="padding: 6px 12px; min-width: auto; font-size: 0.85rem;" onclick="editOrder(${order.id})">‚úèÔ∏è</button>
                            <button class="btn btn-danger" style="padding: 6px 12px; min-width: auto; font-size: 0.85rem;" onclick="deleteOrder(${order.id})">üóëÔ∏è</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
                
                document.getElementById(`month-total-${month.replace(/\s+/g, '-')}`).textContent = monthTotalHours.toFixed(2);
            });
        }
        
        function getMonthIndex(monthName) {
            const months = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', 
                          '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
            return months.indexOf(monthName);
        }
        
        function viewOrderDetails(orderId) {
            const orders = JSON.parse(localStorage.getItem('workOrders')) || [];
            const order = orders.find(o => o.id === orderId);
            
            if (!order) return;
            
            let details = `–î–µ—Ç–∞–ª–∏ ${order.docType === '–Ω–∞—Ä—è–¥' ? '–Ω–∞—Ä—è–¥–∞' : '—Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏—è'} ‚Ññ${order.docNumber}:\n\n`;
            details += `üè¢ –û–±—ä–µ–∫—Ç: ${order.object}\n`;
            details += `üí∞ –í—Å–µ–≥–æ —á–∞—Å–æ–≤: ${order.totalHours}\n\n`;
            
            order.days.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            order.days.forEach((day, index) => {
                const formattedDate = formatDateString(day.date);
                details += `üìÖ –î–µ–Ω—å ${index + 1}: ${formattedDate}\n`;
                details += `   üïê –ù–∞—á–∞–ª–æ: ${day.startTime}, –û–∫–æ–Ω—á–∞–Ω–∏–µ: ${day.endTime}\n`;
                details += `   ‚è∞ –ß–∞—Å–æ–≤: ${day.hours}\n\n`;
            });
            
            alert(details);
        }
        
        function deleteOrder(orderId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?')) {
                let orders = JSON.parse(localStorage.getItem('workOrders')) || [];
                orders = orders.filter(order => order.id !== orderId);
                localStorage.setItem('workOrders', JSON.stringify(orders));
                loadGroupedOrders();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –æ–Ω –∞–∫—Ç–∏–≤–µ–Ω
                if (document.getElementById('chart-tab').classList.contains('active')) {
                    updateChart();
                }
                
                alert('‚úÖ –ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!');
            }
        }
        
        function clearAllRecords() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –í–°–ï –∑–∞–ø–∏—Å–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                localStorage.removeItem('workOrders');
                loadGroupedOrders();
                
                // –û—á–∏—â–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
                if (hoursChart) {
                    hoursChart.destroy();
                    initChart();
                }
                
                alert('‚úÖ –í—Å–µ –∑–∞–ø–∏—Å–∏ —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω—ã!');
            }
        }
        
        function exportToExcel() {
            const orders = JSON.parse(localStorage.getItem('workOrders')) || [];
            
            if (orders.length === 0) {
                alert('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏!');
                return;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –∏ –≥–æ–¥
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const monthName = now.toLocaleString('ru-RU', { month: 'long' });
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
            const filteredOrders = orders.filter(order => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –¥–µ–Ω—å –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ
                return order.days.some(day => {
                    const dayDate = new Date(day.date);
                    return dayDate.getMonth() === currentMonth && dayDate.getFullYear() === currentYear;
                });
            });
            
            if (filteredOrders.length === 0) {
                alert(`‚ùå –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –∑–∞ ${monthName} ${currentYear} –≥–æ–¥–∞!`);
                return;
            }
            
            // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è Excel
            const wsData = [
                ['–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞', '–ù–æ–º–µ—Ä', '–ú–µ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è', '–î–∞—Ç–∞', '–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞', '–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è', '–ß–∞—Å–æ–≤ –∑–∞ –¥–µ–Ω—å']
            ];
            
            let grandTotalHours = 0;
            
            filteredOrders.forEach(order => {
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–Ω–∏ –ø–æ –¥–∞—Ç–µ
                const sortedDays = [...order.days].sort((a, b) => new Date(a.date) - new Date(b.date));
                
                sortedDays.forEach((day, dayIndex) => {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –¥–Ω–∏ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
                    const dayDate = new Date(day.date);
                    if (dayDate.getMonth() === currentMonth && dayDate.getFullYear() === currentYear) {
                        const formattedDate = formatDateString(day.date);
                        
                        wsData.push([
                            dayIndex === 0 ? (order.docType === '–Ω–∞—Ä—è–¥' ? '–ù–∞—Ä—è–¥' : '–†–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ') : '',
                            dayIndex === 0 ? order.docNumber : '',
                            dayIndex === 0 ? order.object : '',
                            formattedDate,
                            day.startTime,
                            day.endTime,
                            day.hours
                        ]);
                    }
                });
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —á–∞—Å—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–Ω–µ–π —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
                const monthHours = order.days
                    .filter(day => {
                        const dayDate = new Date(day.date);
                        return dayDate.getMonth() === currentMonth && dayDate.getFullYear() === currentYear;
                    })
                    .reduce((sum, day) => sum + parseFloat(day.hours), 0);
                
                grandTotalHours += monthHours;
                
                // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –º–µ–∂–¥—É –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
                wsData.push(['', '', '', '', '', '', '']);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ–±—â—É—é –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
            wsData.push([
                '',
                '',
                '',
                '–û–ë–©–ï–ï –ö–û–õ–ò–ß–ï–°–¢–í–û –ß–ê–°–û–í:',
                '',
                '',
                grandTotalHours.toFixed(2)
            ]);
            
            // –°–æ–∑–¥–∞–µ–º –ª–∏—Å—Ç Excel
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ");
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const colWidths = [
                { wch: 15 }, // –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞
                { wch: 15 }, // –ù–æ–º–µ—Ä
                { wch: 30 }, // –ú–µ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                { wch: 15 }, // –î–∞—Ç–∞
                { wch: 12 }, // –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
                { wch: 12 }, // –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
                { wch: 15 }  // –ß–∞—Å–æ–≤ –∑–∞ –¥–µ–Ω—å
            ];
            ws['!cols'] = colWidths;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞
            const fileName = `–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ_${monthName.toLowerCase()}_${currentYear}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            alert(`‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –≤—ã–≥—Ä—É–∂–µ–Ω!\nüìÅ ${fileName}\nüìã –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: ${filteredOrders.length}\nüí∞ –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤: ${grandTotalHours.toFixed(2)}`);
        }
        
        function initChart() {
            const ctx = document.getElementById('hoursChart').getContext('2d');
            hoursChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ —á–∞—Å–æ–≤',
                        data: [],
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        pointBackgroundColor: '#4CAF50',
                        pointBorderColor: '#FFF',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤',
                            font: {
                                size: 18
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `–ß–∞—Å–æ–≤: ${context.raw}`;
                                }
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '–î–∞—Ç–∞'
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
        
        function updateChart() {
            if (!hoursChart) return;
            
            const orders = JSON.parse(localStorage.getItem('workOrders')) || [];
            if (orders.length === 0) {
                hoursChart.data.labels = ['–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'];
                hoursChart.data.datasets[0].data = [0];
                hoursChart.update();
                updateChartSummary([]);
                return;
            }
            
            const period = document.getElementById('chartPeriod').value;
            const chartType = document.getElementById('chartType').value;
            const selectedObject = document.getElementById('chartObject').value;
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –∑–∞–ø–∏—Å–∏ –ø–æ –æ–±—ä–µ–∫—Ç—É
            const filteredOrders = selectedObject === 'all' 
                ? orders 
                : orders.filter(order => order.object === selectedObject);
            
            if (filteredOrders.length === 0) {
                hoursChart.data.labels = ['–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞'];
                hoursChart.data.datasets[0].data = [0];
                hoursChart.update();
                updateChartSummary([]);
                return;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–∏–æ–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
            const now = new Date();
            let startDate = new Date();
            
            switch (period) {
                case 'week':
                    startDate.setDate(now.getDate() - 7);
                    break;
                case 'month':
                    startDate.setMonth(now.getMonth() - 1);
                    break;
                case 'quarter':
                    startDate.setMonth(now.getMonth() - 3);
                    break;
                case 'year':
                    startDate.setFullYear(now.getFullYear() - 1);
                    break;
            }
            
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∫–ª–∞–¥–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞
            let chartData = [];
            let labels = [];
            
            if (currentChartTab === 'daily') {
                chartData = getDailyChartData(filteredOrders, startDate, now);
            } else if (currentChartTab === 'monthly') {
                chartData = getMonthlyChartData(filteredOrders, startDate, now);
            } else if (currentChartTab === 'byType') {
                chartData = getChartDataByType(filteredOrders, startDate, now);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
            hoursChart.data.labels = chartData.labels;
            hoursChart.data.datasets[0].data = chartData.data;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞
            hoursChart.config.type = chartType === 'area' ? 'line' : chartType;
            hoursChart.data.datasets[0].fill = chartType === 'area';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            if (currentChartTab === 'byType') {
                hoursChart.data.datasets[0].backgroundColor = 'rgba(54, 162, 235, 0.2)';
                hoursChart.data.datasets[0].borderColor = '#36A2EB';
                hoursChart.data.datasets[0].pointBackgroundColor = '#36A2EB';
            } else {
                hoursChart.data.datasets[0].backgroundColor = chartType === 'area' ? 'rgba(76, 175, 80, 0.1)' : 'transparent';
                hoursChart.data.datasets[0].borderColor = '#4CAF50';
                hoursChart.data.datasets[0].pointBackgroundColor = '#4CAF50';
            }
            
            hoursChart.update();
            updateChartSummary(chartData.data);
        }
        
        function getDailyChartData(orders, startDate, endDate) {
            const dayMap = {};
            let currentDate = new Date(startDate);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –¥–Ω–∏ –≤ –ø–µ—Ä–∏–æ–¥–µ
            while (currentDate <= endDate) {
                const dateKey = currentDate.toISOString().split('T')[0];
                dayMap[dateKey] = 0;
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            // –°–æ–±–∏—Ä–∞–µ–º —á–∞—Å—ã –ø–æ –¥–Ω—è–º
            orders.forEach(order => {
                order.days.forEach(day => {
                    const dayDate = new Date(day.date);
                    
                    if (dayDate >= startDate && dayDate <= endDate) {
                        const dateKey = dayDate.toISOString().split('T')[0];
                        if (dayMap[dateKey] !== undefined) {
                            dayMap[dateKey] += parseFloat(day.hours);
                        }
                    }
                });
            });
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤—ã –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            const labels = [];
            const data = [];
            
            Object.keys(dayMap).sort().forEach(dateKey => {
                const date = new Date(dateKey);
                labels.push(formatDateString(dateKey));
                data.push(parseFloat(dayMap[dateKey].toFixed(2)));
            });
            
            return { labels, data };
        }
        
        function getMonthlyChartData(orders, startDate, endDate) {
            const monthMap = {};
            let currentDate = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –º–µ—Å—è—Ü—ã –≤ –ø–µ—Ä–∏–æ–¥–µ
            while (currentDate <= endDate) {
                const monthKey = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
                monthMap[monthKey] = 0;
                
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –º–µ—Å—è—Ü—É
                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            
            // –°–æ–±–∏—Ä–∞–µ–º —á–∞—Å—ã –ø–æ –º–µ—Å—è—Ü–∞–º
            orders.forEach(order => {
                order.days.forEach(day => {
                    const dayDate = new Date(day.date);
                    
                    if (dayDate >= startDate && dayDate <= endDate) {
                        const monthKey = `${dayDate.getFullYear()}-${String(dayDate.getMonth() + 1).padStart(2, '0')}`;
                        if (monthMap[monthKey] !== undefined) {
                            monthMap[monthKey] += parseFloat(day.hours);
                        }
                    }
                });
            });
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤—ã –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            const labels = [];
            const data = [];
            
            Object.keys(monthMap).sort().forEach(monthKey => {
                const [year, month] = monthKey.split('-');
                const monthName = new Date(parseInt(year), parseInt(month) - 1, 1)
                    .toLocaleString('ru-RU', { month: 'long' });
                labels.push(`${monthName} ${year}`);
                data.push(parseFloat(monthMap[monthKey].toFixed(2)));
            });
            
            return { labels, data };
        }
        
        function getChartDataByType(orders, startDate, endDate) {
            const typeMap = {
                '–Ω–∞—Ä—è–¥': 0,
                '—Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ': 0
            };
            
            // –°–æ–±–∏—Ä–∞–µ–º —á–∞—Å—ã –ø–æ —Ç–∏–ø–∞–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
            orders.forEach(order => {
                order.days.forEach(day => {
                    const dayDate = new Date(day.date);
                    
                    if (dayDate >= startDate && dayDate <= endDate) {
                        typeMap[order.docType] += parseFloat(day.hours);
                    }
                });
            });
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤—ã –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            const labels = ['–ù–∞—Ä—è–¥—ã', '–†–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏—è'];
            const data = [
                parseFloat(typeMap['–Ω–∞—Ä—è–¥'].toFixed(2)),
                parseFloat(typeMap['—Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ'].toFixed(2))
            ];
            
            return { labels, data };
        }
        
        function updateChartSummary(data) {
            if (data.length === 0) {
                document.getElementById('totalHoursStat').textContent = '0.00';
                document.getElementById('avgHoursStat').textContent = '0.00';
                document.getElementById('maxHoursStat').textContent = '0.00';
                document.getElementById('daysCountStat').textContent = '0';
                return;
            }
            
            const totalHours = data.reduce((sum, hours) => sum + hours, 0);
            const avgHours = totalHours / data.length;
            const maxHours = Math.max(...data);
            const daysCount = data.length;
            
            document.getElementById('totalHoursStat').textContent = totalHours.toFixed(2);
            document.getElementById('avgHoursStat').textContent = avgHours.toFixed(2);
            document.getElementById('maxHoursStat').textContent = maxHours.toFixed(2);
            document.getElementById('daysCountStat').textContent = daysCount;
        }
        
        function switchChartTab(tabName) {
            document.querySelectorAll('.chart-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            event.target.classList.add('active');
            currentChartTab = tabName;
            updateChart();
        }
        
        function downloadChart() {
            const link = document.createElement('a');
            link.href = document.getElementById('hoursChart').toDataURL('image/png');
            link.download = `–≥—Ä–∞—Ñ–∏–∫_—á–∞—Å–æ–≤_${new Date().toISOString().split('T')[0]}.png`;
            link.click();
            alert('‚úÖ –ì—Ä–∞—Ñ–∏–∫ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
        }
        
        function resetChartFilters() {
            document.getElementById('chartPeriod').selectedIndex = 1; // –º–µ—Å—è—Ü
            document.getElementById('chartType').selectedIndex = 1; // –ª–∏–Ω–µ–π–Ω—ã–π
            document.getElementById('chartObject').selectedIndex = 0; // –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞
            document.querySelectorAll('.chart-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector('.chart-tab:first-child').classList.add('active');
            currentChartTab = 'daily';
            
            updateChart();
            alert('‚úÖ –§–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã!');
        }
        
        // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
        function editOrder(orderId) {
            const orders = JSON.parse(localStorage.getItem('workOrders')) || [];
            const order = orders.find(o => o.id === orderId);
            
            if (!order) {
                alert('–ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                return;
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å"
            switchTab('main');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º ID —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–π –∑–∞–ø–∏—Å–∏
            editingOrderId = orderId;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –∑–∞–ø–∏—Å–∏
            document.getElementById('docNumber').value = order.docNumber;
            document.getElementById('objectSelect').value = order.object;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞
            document.querySelectorAll('input[name="docType"]').forEach(radio => {
                radio.checked = (radio.value === order.docType);
            });
            
            document.querySelectorAll('.doc-type-option').forEach(option => {
                option.classList.remove('active');
            });
            
            if (order.docType === '–Ω–∞—Ä—è–¥') {
                document.querySelector('.doc-type-option:first-child').classList.add('active');
                maxDays = 30;
            } else {
                document.querySelector('.doc-type-option:last-child').classList.add('active');
                maxDays = 1;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–Ω–∏ –∏–∑ –∑–∞–ø–∏—Å–∏
            currentDays = [...order.days];
            renderAllDays();
            updateDaysCount();
            updateTotalHours();
            checkDateConstraints();
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ñ–æ—Ä–º–µ
            document.getElementById('main-tab').scrollIntoView({ behavior: 'smooth' });
            
            alert('üìù –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∫–ª—é—á–µ–Ω. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å"');
        }
        
        // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function saveOrder() {
            const docType = document.querySelector('input[name="docType"]:checked').value;
            const docNumber = document.getElementById('docNumber').value.trim();
            const object = document.getElementById('objectSelect').value;
            
            if (!docNumber || !object) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç!');
                return;
            }
            
            if (currentDays.length === 0) {
                alert('‚ö†Ô∏è –î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –¥–µ–Ω—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç!');
                return;
            }
            
            // –î–ª—è —Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –¥–µ–Ω—å
            if (docType === '—Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ' && currentDays.length > 1) {
                alert('‚ö†Ô∏è –†–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ –≤—ã–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–∏–Ω –¥–µ–Ω—å!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è
            for (let i = 0; i < currentDays.length; i++) {
                const day = currentDays[i];
                if (!day.startTime || !day.endTime) {
                    alert(`‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–ª—è –¥–Ω—è ${i + 1}!`);
                    return;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –Ω–∞—Ä—è–¥–æ–≤
            if (docType === '–Ω–∞—Ä—è–¥') {
                if (currentDays.length > 30) {
                    alert('‚ö†Ô∏è –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è –Ω–∞—Ä—è–¥–∞ - 30!');
                    return;
                }
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–Ω–∏ –ø–æ –¥–∞—Ç–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                currentDays.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–Ω–∏—Ü—ã –≤ 30 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π
                const firstDate = new Date(currentDays[0].date);
                const lastDate = new Date(currentDays[currentDays.length - 1].date);
                const diffTime = Math.abs(lastDate - firstDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays > 30) {
                    alert(`‚ùå –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ø–µ—Ä–≤–æ–π –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –¥–∞—Ç–∞–º–∏ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ${diffDays} –¥–Ω–µ–π. –ú–∞–∫—Å–∏–º—É–º 30 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π –¥–ª—è –æ–¥–Ω–æ–≥–æ –Ω–∞—Ä—è–¥–∞!`);
                    return;
                }
            }
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤
            const totalHours = currentDays.reduce((sum, day) => sum + parseFloat(day.hours), 0);
            
            if (editingOrderId) {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
                let orders = JSON.parse(localStorage.getItem('workOrders')) || [];
                const orderIndex = orders.findIndex(o => o.id === editingOrderId);
                
                if (orderIndex !== -1) {
                    orders[orderIndex] = {
                        id: editingOrderId,
                        docType: docType,
                        docNumber: docNumber,
                        object: object,
                        days: [...currentDays],
                        totalHours: totalHours.toFixed(2),
                        timestamp: orders[orderIndex].timestamp // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—É—é –¥–∞—Ç—É —Å–æ–∑–¥–∞–Ω–∏—è
                    };
                    
                    localStorage.setItem('workOrders', JSON.stringify(orders));
                    alert('‚úÖ –ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
                } else {
                    alert('‚ùå –ó–∞–ø–∏—Å—å –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                }
                
                editingOrderId = null;
            } else {
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
                const order = {
                    id: Date.now(),
                    docType: docType,
                    docNumber: docNumber,
                    object: object,
                    days: [...currentDays],
                    totalHours: totalHours.toFixed(2),
                    timestamp: new Date().toISOString()
                };
                
                let orders = JSON.parse(localStorage.getItem('workOrders')) || [];
                orders.push(order);
                localStorage.setItem('workOrders', JSON.stringify(orders));
                alert('‚úÖ –ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
            }
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            clearForm();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –∑–∞–ø–∏—Å–µ–π
            loadGroupedOrders();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –æ–Ω –∞–∫—Ç–∏–≤–µ–Ω
            if (document.getElementById('chart-tab').classList.contains('active')) {
                updateChart();
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            editingOrderId = null;
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeEditModal();
            }
        };
    </script>
</body>
</html>
